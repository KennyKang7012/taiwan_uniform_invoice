# 統一發票中獎號碼爬取與展示系統 - 成果報告

本專案已成功開發一套基於 Python 的自動化爬蟲系統，能從財政部官網爬取最近兩年的中獎號碼，並生成一個高品質的靜態網頁供使用者查詢。

## 實作成果亮點

### 1. 自動化爬蟲 (`scraper.py`)
- **智能過濾**：嚴格遵守「序號為偶數」的規則，僅擷取一般中獎號碼。
- **資料範圍**：成功爬取最近兩年共 12 個期別的資料（114年 09~10 月至 112年 11~12 月）。
- **健壯性**：具備自動偵測網頁編碼與移除重複期別的功能。

### 2. 現代化靜態網頁 (`index.html`)
- **高品質設計**：使用流暢的漸層背景、圓角卡片與 Google Fonts (Inter, Noto Sans TC)。
- **互動體驗**：具備期別快速切換按鈕，點擊後平滑顯示對應中獎號碼。
- **響應式佈局**：支援手機與電腦螢幕查看，視覺效果一致。

## 視覺展示

### 網頁介面預覽

![中獎號碼查詢介面](./screenshots/web_preview.png)
> 本圖展示了 114 年 07 ~ 08 月期的中獎號碼，可以看到清楚的獎項分類與加大的紅色中獎號碼。

---

## 爬蟲開發挑戰與解決方案

在開發過程中，我們遇到了幾個關鍵的技術挑戰，以下是詳細的記錄與解決方法：

### 1. 網頁編碼亂碼問題 (Encoding Issue)
*   **困難點**：財政部官網在部分請求下返回的編碼偵測不穩定，導致抓取到的繁體中文字元出現亂碼（如 `114å¹´`）。
*   **解決方案**：
    *   在 `scraper.py` 中使用 `response.apparent_encoding` 來強制設定編碼。
    *   在 `generator.py` 寫入 `index.html` 時，明確指定 `encoding='utf-8'`。

### 2. 複雜且不一致的 DOM 結構 (DOM Structure)
*   **困難點**：
    *   列表頁中，序號竟然放在 `<th>` 而非 `<td>`，且連結的路徑包含相對路徑偏移（如 `/etwmain/../`）。
    *   詳情頁中，中獎號碼的 HTML 標籤不統一（有時在 `div`，有時在 `td`），且包含許多描述性雜訊。
*   **解決方案**：
    *   更新選擇器以同時支援 `th` 與 `td` 的混合結構。
    *   引入 **正則表達式 (Regex)** `\b\d{8}\b` 來精確提取 8 位數的中獎號碼，過濾掉非數字的描述文字。

### 3. 資料重複與分頁抓取 (Data Duplication)
*   **困難點**：官網的分頁邏輯在某些頁面會重複顯示已出現過的期別，導致生成網頁時出現重複的按鈕。
*   **解決方案**：
    *   實作 `seen_periods` 集合 (Set) 進行去重。
    *   加入日期年份過濾 logic，確保資料嚴格限制在「最近兩年」內。

---

## 驗證紀錄

| 驗證項目 | 結果 | 備註 |
| :--- | :--- | :--- |
| 期別完整性 | ✅ 通過 | 包含最近兩年共 12 個期別 |
| 資料正確性 | ✅ 通過 | 號碼與財政部官網內容完全一致 |
| 繁體中文編碼 | ✅ 通過 | 已修正亂碼問題，顯示正常 |
| 跨裝置相容性 | ✅ 通過 | 支援 RWD 響應式佈局 |

## 如何重新生成
若未來有新期別開獎，只需執行以下指令即可更新網頁：
```bash
uv run python scraper.py && uv run python generator.py
```
執行完後會生成最新的 `index.html`。
